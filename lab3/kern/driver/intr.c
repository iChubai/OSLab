/* ======================================================================================
 * intr.c - 中断使能/禁用控制
 *
 * 这个文件提供了基本的硬件中断控制功能：
 * - intr_enable(): 启用中断
 * - intr_disable(): 禁用中断
 *
 * 在RISC-V架构中，中断的控制通过sstatus寄存器的SIE位实现：
 * - SIE (Supervisor Interrupt Enable)位控制监管者态的中断是否被允许
 * - 当SIE=1时，允许中断；当SIE=0时，禁止中断
 *
 * 这些函数通常用于：
 * 1. 保护临界区代码不被中断打断
 * 2. 在中断处理程序中临时禁用中断
 * 3. 系统初始化时控制中断状态
 * ====================================================================================== */

#include <intr.h>           // 中断相关定义
#include <riscv.h>          // RISC-V特有定义和CSR操作

/* ======================================================================================
 * intr_enable - 启用硬件中断
 *
 * 设置sstatus寄存器的SIE位，允许处理器响应中断
 * 当中断发生时，处理器会跳转到stvec指向的处理程序
 *
 * 使用场景：
 * - 系统初始化完成后启用中断
 * - 从临界区退出时恢复中断
 * - 中断处理完成后重新启用中断
 *
 * 注意：这个函数只影响监管者态的中断，用户态中断由其他机制控制
 * ====================================================================================== */
void intr_enable(void) {
    /* 设置sstatus的SIE位为1，启用中断 */
    set_csr(sstatus, SSTATUS_SIE);
}

/* ======================================================================================
 * intr_disable - 禁用硬件中断
 *
 * 清除sstatus寄存器的SIE位，禁止处理器响应中断
 * 当中断发生时，它们会被pending直到重新启用
 *
 * 使用场景：
 * - 进入临界区前禁用中断
 * - 中断处理程序开始时禁用中断（避免嵌套中断）
 * - 需要原子操作时禁用中断
 *
 * 注意：这个函数只影响监管者态的中断，用户态中断仍然可以发生
 * ====================================================================================== */
void intr_disable(void) {
    /* 清除sstatus的SIE位为0，禁用中断 */
    clear_csr(sstatus, SSTATUS_SIE);
}
